<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-functions.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBHE1aJIkSGu-3X6uMCoFmw3Gah14dng58",
    authDomain: "my-pbi-dashboard.firebaseapp.com",
    projectId: "my-pbi-dashboard",
    storageBucket: "my-pbi-dashboard.appspot.com",
    messagingSenderId: "776252651257",
    appId: "1:776252651257:web:757618a489ed6123d95428",
    measurementId: "G-263J3ZLSJJ"
  };

  const app = initializeApp(firebaseConfig);
  const functions = getFunctions(app);
  const signUpWithWhitelistFunction = httpsCallable(functions, 'signUpWithWhitelist');

  const msgElement = document.getElementById("msg");

  document.getElementById("signupBtn").addEventListener("click", async () => {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const secretKey = document.getElementById("secretKey").value.trim();

    // Tambahan DEBUG LOG
    console.log("DEBUG - Email:", email);
    console.log("DEBUG - Password:", password);
    console.log("DEBUG - Secret Key:", secretKey);

    msgElement.style.color = "white";
    msgElement.textContent = "Memproses pendaftaran...";

    try {
      const result = await signUpWithWhitelistFunction({
        email: email,
        password: password,
        secretKey: secretKey
      });

      msgElement.style.color = "lightgreen";
      msgElement.textContent = result.data.message;
      setTimeout(() => {
        window.location = "index.html";
      }, 2000);

    } catch (error) {
      msgElement.style.color = "red";
      if (error.code === "permission-denied") {
        msgElement.textContent = error.message;
      } else if (error.code === "invalid-argument") {
        msgElement.textContent = error.message;
      } else if (error.code === "already-exists") {
        msgElement.textContent = error.message;
      } else {
        msgElement.textContent = `Terjadi kesalahan: ${error.message}`;
      }
      console.error("Error dari Cloud Function:", error);
    }
  });
</script>
